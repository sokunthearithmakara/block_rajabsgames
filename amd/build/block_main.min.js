define("block_rajabsgames/block_main",["exports","jquery","core_form/modalform","core/templates"],(function(_exports,_jquery,_modalform,_templates){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_modalform=_interopRequireDefault(_modalform),_templates=_interopRequireDefault(_templates);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_exports.init=async(blockid,contextid,courseid,userid)=>{let string=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/str"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/str")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/str"]));const bindEvents=(event,selector,func)=>{(0,_jquery.default)(document).off(event,selector).on(event,selector,func)};bindEvents("click","#add-badge",(async function(){let data={contextid:contextid,courseid:courseid,userid:userid,blockid:blockid};const form=new _modalform.default({modalConfig:{title:await string.get_string("addbadge","block_rajabsgames")},formClass:"block_rajabsgames\\badge_form",args:data});form.show(),form.addEventListener(form.events.FORM_SUBMITTED,(async event=>{(0,_jquery.default)(".rg_badges_list .empty-message").remove();let response=event.detail,badge=await _templates.default.render("block_rajabsgames/badge",{badges:[{id:response.badgeid,name:response.badge_name,picture:response.url}]});(0,_jquery.default)(".rg_badges_list").append(badge);let badges=JSON.parse((0,_jquery.default)("[name=config_badges]").val()||"[]");Array.isArray(badges)||(badges=[]),badges.push({id:response.badgeid,name:response.badge_name,picture:response.url}),(0,_jquery.default)("[name=config_badges]").val(JSON.stringify(badges))}))})),bindEvents("click",".delete-badge",(async function(){let badgeid=(0,_jquery.default)(this).data("id");(0,_jquery.default)('.rg_badge_item[data-id="'+badgeid+'"]').remove();let badges=JSON.parse((0,_jquery.default)("[name=config_badges]").val()||"[]");badges=badges.filter((badge=>badge.id!==badgeid)),(0,_jquery.default)("[name=config_badges]").val(JSON.stringify(badges))})),bindEvents("click",".edit-badge",(async function(){let badgeid=(0,_jquery.default)(this).data("id"),badges=JSON.parse((0,_jquery.default)("[name=config_badges]").val()||"[]"),badge=badges.find((badge=>badge.id===badgeid)),url=badge.picture,used=(0,_jquery.default)(this).data("used"),draftid=url.match(/user\/draft\/(\d+)/);draftid=draftid?draftid[1]:"";let data={contextid:contextid,courseid:courseid,userid:userid,blockid:blockid,badgeid:badge.id,badge_name:badge.name,url:url,draftid:draftid};const form=new _modalform.default({modalConfig:{title:await string.get_string("addbadge","block_rajabsgames")},formClass:"block_rajabsgames\\badge_form",args:data});form.show(),form.addEventListener(form.events.FORM_SUBMITTED,(async event=>{let response=event.detail,badgedata={id:response.badgeid,name:response.badge_name,picture:response.url};badges=badges.filter((badge=>badge.id!==badgeid)),badges.push(badgedata),badges.sort(((a,b)=>a.id-b.id)),(0,_jquery.default)("[name=config_badges]").val(JSON.stringify(badges)),badgedata.used=used;let badge=await _templates.default.render("block_rajabsgames/badge",{badges:[badgedata]});(0,_jquery.default)('.rg_badge_item[data-id="'+badgeid+'"]').replaceWith(badge)}))})),bindEvents("click","#add-level",(async function(){let data={contextid:contextid,courseid:courseid,userid:userid,blockid:blockid,order:1},form=new _modalform.default({modalConfig:{title:await string.get_string("addlevel","block_rajabsgames")},formClass:"block_rajabsgames\\level_form",args:data});form.show(),form.addEventListener(form.events.FORM_SUBMITTED,(async event=>{let response=event.detail,leveldata={id:response.levelid,name:response.level_name,order:response.order,xp:response.xplimit},levels=JSON.parse((0,_jquery.default)("[name=config_levels]").val()||"[]");Array.isArray(levels)||(levels=[]),levels.push(leveldata),levels.sort(((a,b)=>a.xp-b.xp));for(let i=0;i<levels.length;i++)levels[i].order=i+1;let level=await _templates.default.render("block_rajabsgames/level",{levels:levels});(0,_jquery.default)(".rg_level_list").empty().append(level),(0,_jquery.default)("[name=config_levels]").val(JSON.stringify(levels))}))})),bindEvents("click",".delete-level",(async function(){let levelid=(0,_jquery.default)(this).data("id"),levels=JSON.parse((0,_jquery.default)("[name=config_levels]").val()||"[]");levels=levels.filter((level=>level.id!==levelid)),levels.sort(((a,b)=>a.order-b.order));for(let i=0;i<levels.length;i++)levels[i].order=i+1;let level=await _templates.default.render("block_rajabsgames/level",{levels:levels});(0,_jquery.default)(".rg_level_list").empty().append(level),(0,_jquery.default)("[name=config_levels]").val(JSON.stringify(levels))})),bindEvents("click",".edit-level",(async function(){let levelid=(0,_jquery.default)(this).data("id"),levels=JSON.parse((0,_jquery.default)("[name=config_levels]").val()||"[]"),level=levels.find((level=>level.id===levelid)),data={contextid:contextid,courseid:courseid,userid:userid,blockid:blockid,order:level.order,levelid:level.id,level_name:level.name,xplimit:level.xp},form=new _modalform.default({modalConfig:{title:await string.get_string("editlevel","block_rajabsgames")},formClass:"block_rajabsgames\\level_form",args:data});form.show(),form.addEventListener(form.events.FORM_SUBMITTED,(async event=>{let response=event.detail;levels=levels.filter((level=>level.id!==levelid));let leveldata={id:response.levelid,name:response.level_name,order:response.order,xp:response.xplimit};levels.push(leveldata),levels.sort(((a,b)=>a.xp-b.xp));for(let i=0;i<levels.length;i++)levels[i].order=i+1;let level=await _templates.default.render("block_rajabsgames/level",{levels:levels});(0,_jquery.default)(".rg_level_list").empty().append(level),(0,_jquery.default)("[name=config_levels]").val(JSON.stringify(levels))}))}))}}));

//# sourceMappingURL=block_main.min.js.map